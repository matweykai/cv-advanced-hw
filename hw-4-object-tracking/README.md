# Домашнее задание по трекингу
В рамках данного домашнего задания необходимо реализовать трекинг объектов на основе детекции, полученных от уже готового детектора.

## Метрика
Оценка качества трекинга модели производится по формуле:
$$
    track\_metric = 1 - \frac{IDSW}{GT}
    \\ IDSW - \text{кол-во переключений трека, }
    \\ GT - \text{кол-во детекций}
$$

Она показывает как часто трекер переключается между треками, это может быть связано или с потерей трека или с неправильным матчингом объекта с соседом. Реализация метрики находится в файле [metrics.py](metrics.py).

Чем выше метрика, тем более стабильны треки, чем меньше метрика, тем чаще трекер путается.

## Soft Tracker
Для реализации Soft Tracker был взят достаточно простой подход. Вычисляется центр каждого прямоугольника, считается расстояние до прямоугольников уже затреканных объектов и далее производится матчинг на основе расстояний через венгерский алгоритм. Реализация метода находится в файле [soft_tracker.py](soft_tracker.py).

Для того, чтобы трекер мог забывать объекты, которые он уже давно видел в алгоритме есть время, которое бокс хранится в памяти (параметр **forget_time**), а также для того, чтобы не матчить очень дальние объекты вводится дополнительная фильтрация по расстоянию (параметр **max_match_dist**).

## Strong Tracker
Чтобы улучшить качество трекинга относительно soft_tracker была написана реализация SORT трекера, с расстоянием gIOU вместо IOU, так как оно позволяет матчить боксы, даже которые не имеют пересечения, от чего страдает SORT трекер. Параметры данного трекера аналогичны soft_tracker: forget_time и max_match_dist. Реализация метода находится в файле [strong_tracker.py](strong_tracker.py).

## Тесты
Были проведены тесты двух трекеров. Изменялись параметры bb_skip, random_range и tracks_amount.

| Файл эксперимента | bb_skip | random_range | tracks_amount | soft_tracker metric | strong_tracker metric |
|-------------------|---------|--------------|---------------|---------------------|-----------------------|
| track_1.py        | 0.25    | 10           | 5             | 0.885               | 0.763                 |
| track_2.py        | 0.25    | 10           | 10            | 0.883               | 0.725                 |
| track_3.py        | 0.25    | 10           | 20            | 0.823               | 0.672                 |
| track_5.py        | 0.25    | 20           | 5             | 0.958               | 0.84                  |
| track_6.py        | 0.25    | 20           | 10            | 0.904               | 0.739                 |
| track_7.py        | 0.25    | 20           | 20            | 0.824               | 0.704                 |
| track_8.py        | 0.4     | 10           | 5             | 0.894               | 0.649                 |
| track_9.py        | 0.4     | 10           | 10            | 0.909               | 0.625                 |
| track_10.py       | 0.4     | 10           | 20            | 0.752               | 0.571                 |
| track_11.py       | 0.4     | 20           | 5             | 0.774               | 0.714                 |
| track_12.py       | 0.4     | 20           | 10            | 0.747               | 0.63                  |
| track_13.py       | 0.4     | 20           | 20            | 0.829               | 0.589                 |
| track_14.py       | 0.5     | 10           | 5             | 0.889               | 0.657                 |
| track_15.py       | 0.5     | 10           | 10            | 0.733               | 0.453                 |
| track_16.py       | 0.5     | 10           | 20            | 0.72                | 0.514                 |
| track_17.py       | 0.5     | 20           | 5             | 0.857               | 0.52                  |
| track_18.py       | 0.5     | 20           | 10            | 0.88                | 0.553                 |
| track_19.py       | 0.5     | 20           | 20            | 0.723               | 0.516                 |

#### Выводы по тестам:
- tracker_strong работает хуже чем tracker_soft, хотя в первом используется динамическая модель предсказания движения, а во втором просто сравнение расстояний
- были опробованы различные модификации SORT трекера (замена gIOU на евклидово расстояние, обновление lost треков)
- в целом качество трекинга падает при увеличении числа объектов (это логично, тк есть больше вариантов спутать объект)
- random_range не так критичен для обоих трекеров (значения отклонений не очень большие)
- bb_skip сильно влияет на strong_tracker (т.к если объект потерян, то обновление фильтра Калмана не происходит), а на soft_tracker это не сильно влияло

**Итог:** sort трекер чувствителен к качеству детекции, особенно, если бокс не задетектился. Можно использовать и достаточно простые детекторы, тк они тоже показывают хорошее качество


